# MercariKit - 販売管理システム

React + TypeScript + Supabase で構築されたメルカリ販売管理システム

## 概要

MercariKitは中古品販売事業者向けの包括的な販売管理システムです。商品の仕入れから出品、売却まで一連の流れを効率的に管理できます。

## 主要機能

### 🏠 ホーム
- ダッシュボード形式でシステム全体の状況を表示
- 主要メトリクスの可視化

### 📦 商品管理
- 商品一覧表示とフィルタリング機能
- 商品詳細情報の編集
- 按分後単価の自動計算・表示
- 商品ステータス管理

### 🛒 仕入管理
- **購入セッション管理**: 仕入日の入力対応（過去日付可能）
- 店舗別仕入れ情報管理
- 商品登録（写真、詳細情報、採寸データ）
- **コスト計算機能**: 商品代金 + 店舗経費 + 共通経費按分

### 🏪 店舗マスタ
- 仕入れ店舗情報の管理
- **地方別都道府県選択**: 地方→都道府県の2段階選択システム
- 店舗別データ分析

### 📝 出品準備
- メルカリ出品用タイトル・説明文作成
- テンプレート機能による説明文自動生成
- 採寸データの自動挿入
- 出品価格設定

### 💰 出品管理（旧：売却管理）
- 出品済み商品の管理
- **商品画像表示**: 48x48px サムネイル対応
- 情報修正機能（価格調整・タイトル変更）
- **売却処理**: 価格、日付、発送方法、販売手数料10%自動計算
- 保留処理（理由・日付記録）
- 廃棄処理（理由記録）

### 📊 分析
- **月別集計分析**: 売上、販売手数料10%、送料、利益、利益率、販売数、平均単価
- **セッション別分析**: 費用内訳、売上内訳、収益分析の3分割表示
- **店舗別パフォーマンス**: 仕入点数、破棄点数、出品点数、売却済、仕入金額（経費込）、売却高、売却経費、利益、利益率、ROI

### ⚙️ 設定
- システム設定
- ユーザー設定

## 技術スタック

- **Frontend**: React 18 + TypeScript + Vite
- **Backend**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth (Google OAuth)
- **UI**: Tailwind CSS + Lucide Icons + react-datepicker
- **Security**: Row Level Security (RLS)
- **State Management**: React Context API + Hooks

## データベース構造

### 主要テーブル
- `products` - 商品情報
- `store_purchases` - 店舗購入情報
- `purchase_sessions` - 購入セッション（user_id付き）
- `stores` - 店舗マスタ（user_id付き）

### マルチテナント対応
- **Row Level Security (RLS)**: ユーザーごとのデータアクセス制御
- **user_id**: 認証ユーザーとの紐付け
- **セキュアなデータ分離**: ユーザー間でのデータ完全分離

### 商品ステータス
- `in_stock` - 在庫中
- `ready_to_list` - 出品準備完了
- `listed` - 出品済み
- `sold` - 売却済み
- `on_hold` - 保留中
- `discarded` - 廃棄済み

## 主要な実装機能

### 按分コスト計算
商品の真の仕入れコストを算出するため、以下を考慮した按分計算を実装：
- 店舗での商品代金
- 送料・手数料
- セッション共通コスト（交通費、振込手数料、代行手数料）

計算式：
```
按分後単価 = (店舗コスト + セッション共通コスト) / 店舗商品数
```

### テンプレートシステム
商品説明文の自動生成機能：
- 外部ファイル管理による運用性確保
- カテゴリ別採寸データの自動挿入
- 定型文の統一化

### 採寸データ管理
カテゴリ別の採寸項目を動的生成：
- トップス：肩幅、身幅、着丈、袖丈
- ボトムス：ウエスト、ヒップ、股下、股上、もも周り、裾周り
- アウター：肩幅、身幅、着丈、袖丈

## セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev

# Supabaseローカル環境起動
npx supabase start
```

## 環境設定

`.env` ファイルに以下を設定：
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## データベースマイグレーション

最新のマイグレーションファイル：
- `migrate_allocated_cost.js` - 按分コスト計算用
- `add_sales_management_columns.sql` - 出品管理機能用
- `20250913_fix_purchase_sessions_created_at.sql` - セッション日付フィールド修正

## 主要ファイル構成

```
src/
├── components/
│   ├── Layout.tsx              # レイアウトコンポーネント
│   └── FloatingHomeButton.tsx  # フローティングホームボタン
├── pages/
│   ├── Home.tsx               # ホーム画面
│   ├── Products.tsx           # 商品管理
│   ├── ProductDetail.tsx      # 商品詳細画面
│   ├── ProductEdit.tsx        # 商品編集画面
│   ├── ProductStores.tsx      # 商品別店舗分析
│   ├── Purchases.tsx          # 仕入管理
│   ├── ListingManagement.tsx  # 出品準備
│   ├── SalesManagement.tsx    # 出品管理
│   ├── Analytics.tsx          # 分析ダッシュボード
│   ├── StoreAnalysis.tsx      # 店舗分析
│   ├── Reports.tsx            # レポート
│   └── StorePurchaseDetail.tsx # 商品登録
├── hooks/
│   └── useProductEdit.ts      # 商品編集用カスタムフック
├── templates/
│   └── productDescriptionTemplate.js # 商品説明テンプレート
├── lib/
│   └── supabase.ts           # Supabase設定
└── types/
    └── index.ts              # 型定義（配送タイプ追加）
```

## 開発履歴

### v3.0.0（最新）
- **🔐 Google認証機能実装**: ユーザーごとのセキュアなアクセス制御
- **🛡️ Row Level Security対応**: データベースレベルでの権限管理
- **👤 マルチテナント対応**: 複数ユーザーでの安全なデータ共有防止
- **📅 日付選択改善**: react-datepicker導入で使いやすいカレンダーUI
- **💰 仕入コスト計算精度向上**: 経費按分を含む実際のコスト表示

### v2.9.0
- **商品詳細画面実装**: 商品の全情報を一覧表示、コピー機能付き
- **商品編集機能強化**: 詳細画面から直接編集画面へ遷移
- **配送管理機能追加**: 予定配送と実際の配送情報を分離管理
- **アセットタイプ機能**: 資産型/回転型商品の分類表示
- **UIコンポーネント追加**: フローティングホームボタン実装
- **レポート機能**: 各種分析レポートの基盤整備

### v2.8.0
- **分析機能大幅強化**: 月別集計、セッション別分析、店舗別パフォーマンス
- **店舗マスタ改善**: 地方別都道府県選択システム
- **仕入管理機能拡張**: セッション日付入力、過去日付対応
- **出品管理UI改善**: 商品画像表示、販売手数料自動計算
- **コスト計算精度向上**: 共通経費按分ロジック修正

### v2.7.0
- 出品管理システム実装
- 商品ステータス管理強化（保留・廃棄機能追加）
- UI/UX改善（アクションボタン拡大、ホバー効果）
- メニュー整理（状態管理削除）

### v2.6.0
- 按分コスト計算システム実装
- 商品管理画面のフィルタリング機能追加
- テンプレートシステム外部ファイル化

### v2.5.0
- 採寸データ入力機能追加
- 商品編集機能の全面改修
- UIコンポーネント統一化

## ライセンス

Private - 商用利用